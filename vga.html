
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>RP6502-VGA &#8212; Picocomputer  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="RP6502-OS" href="os.html" />
    <link rel="prev" title="RP6502-RIA-W" href="ria_w.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Picocomputer</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hardware.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="ria.html">RP6502-RIA</a></li>
<li class="toctree-l1"><a class="reference internal" href="ria_w.html">RP6502-RIA-W</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">RP6502-VGA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#video-programming">Video Programming</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#key-registers">Key Registers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mode-0-console">Mode 0: Console</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mode-1-character">Mode 1: Character</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mode-2-tile">Mode 2: Tile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mode-3-bitmap">Mode 3: Bitmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mode-4-sprite">Mode 4: Sprite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#control-channel-f">Control Channel $F</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#backchannel">Backchannel</a></li>
<li class="toctree-l2"><a class="reference internal" href="#terminal">Terminal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#c0-control-codes">C0 control codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fe-escape-sequences">Fe Escape Sequences</a></li>
<li class="toctree-l3"><a class="reference internal" href="#csi-sequences">CSI Sequences</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sgr-parameters">SGR Parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="os.html">RP6502-OS</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="ria_w.html" title="previous chapter">RP6502-RIA-W</a></li>
      <li>Next: <a href="os.html" title="next chapter">RP6502-OS</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="ria_w.html" title="Previous document">RP6502-RIA-W</a>
        </li>
        <li>
          <a href="os.html" title="Next document">RP6502-OS</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <div class="section" id="rp6502-vga">
<h1>RP6502-VGA<a class="headerlink" href="#rp6502-vga" title="Permalink to this headline">¶</a></h1>
<p>RP6502 - Video Graphics Array</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The RP6502 Video Graphics Array is a Raspberry Pi Pico 2 with
<a class="reference internal" href="#"><span class="doc">RP6502-VGA</span></a> firmware. Its primary data connection is to a <a class="reference internal" href="ria.html"><span class="doc">RP6502-RIA</span></a>
over a 5-wire PIX bus. More than one VGA module can be put on a PIX
bus. Note that all VGA modules share the same 64K of XRAM and only
the first one will generate frame numbers and vsync interrupts.</p>
</div>
<div class="section" id="video-programming">
<h2>Video Programming<a class="headerlink" href="#video-programming" title="Permalink to this headline">¶</a></h2>
<p>The VGA system provides virtual video hardware that is similar
to home computer and arcade hardware from the 8-bit and early
16-bit era. It is very easy to add new video modes and sprite
systems. The 6502 application programmer can mix and match these
modes.</p>
<p>The VGA system is built around the scanvideo library from Pi
Pico Extras. All three planes are enabled with RGB555 color plus
transparency. The mode 4 sprite system is from Pi Pico Playground.
The programming system and all other modes are original work for
the RP6502.</p>
<p>The RP6502 VGA system exposes per-scanline configuration of the
video system to your 6502 application. At the broadest scope we
have three planes. Each plane has two layers, a fill layer and a
sprite layer. Your application can assign different fill and
sprite modes to specific planes and scanlines. There’s plenty of
fill rate to exceed the capabilities of any classic 8-bit system,
but if you like to push the limits then you may see a half-blue
screen indicating you went too far.</p>
<p>The built-in 8x8 and 8x16 fonts are available by using the special
XRAM pointer $FFFF. Glyphs 0-127 are ASCII, glyphs 128-255 vary
depending on the code page selected.</p>
<p>The built-in color palettes are accessed by using the special XRAM
pointer $FFFF. 1-bit is black and white. 4 and 8-bits point to an
ANSI color palette of 16 colors, followed by 216 colors (6x6x6),
followed by 24 greys.</p>
<p>16-bit colors are built with the following bit logic. Setting the
alpha bit will make the color opaque. The built-in ANSI color
palette has the alpha bit set on all colors except color 0 black.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="cp">#define COLOR_FROM_RGB8(r,g,b) (((b&gt;&gt;3)&lt;&lt;11)|((g&gt;&gt;3)&lt;&lt;6)|(r&gt;&gt;3))</span>
<span class="cp">#define COLOR_FROM_RGB5(r,g,b) ((b&lt;&lt;11)|(g&lt;&lt;6)|(r))</span>
<span class="cp">#define COLOR_ALPHA_MASK (1u&lt;&lt;5)</span>
</pre></div>
</div>
<p>Palette information is an array. 8bpp, 4bpp, and 1bpp modes use a
palette. 16 bit per pixel modes don’t use indexed color and will
ignore the palette. Palettes must be 16-bit aligned.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
    <span class="kt">uint16_t</span> <span class="n">color</span><span class="p">;</span>
<span class="p">}</span> <span class="n">palette</span><span class="p">[</span><span class="mi">2</span><span class="o">^</span><span class="n">bits_per_pixel</span><span class="p">];</span>
</pre></div>
</div>
<p>Programming the VGA device is done with PIX extended registers -
XREGS. VGA is PIX device ID 1. Registers are 16 bit values addressed
by $device:$channel:register. e.g. $1:0:0F</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// Select a 320x240 canvas</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">xreg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// or</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">xreg_vga_canvas</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="c1">// Program mode 3 for 4 bit color with</span>
<span class="c1">// its config registers at XRAM $FF00.</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">xreg</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0xFF00</span><span class="p">);</span> <span class="c1">// or</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">xreg_vga_mode</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0xFF00</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="key-registers">
<h3>Key Registers<a class="headerlink" href="#key-registers" title="Permalink to this headline">¶</a></h3>
<p>Setting key registers may return a failure (-1) with errno EINVAL.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$1:0:00</p></td>
<td><p>CANVAS</p></td>
<td><p>Select a graphics canvas. This clears $1:0:02-$1:0:FF and all
scanline programming. The 80 column console canvas is used as
a failsafe and therefore not scanline programmable.</p>
<ul class="simple">
<li><p>0 - 80 column console. (4:3 or 5:4)</p></li>
<li><p>1 - 320x240 (4:3)</p></li>
<li><p>2 - 320x180 (16:9)</p></li>
<li><p>3 - 640x480 (4:3)</p></li>
<li><p>4 - 640x360 (16:9)</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>$1:0:01</p></td>
<td><p>MODE</p></td>
<td><p>Program a mode into a plane of scanlines.
$1:0:02-$1:0:FF cleared after programming. Each mode has a
section of this document for its own registers.</p>
<ul class="simple">
<li><p>0 - Console</p></li>
<li><p>1 - Character</p></li>
<li><p>2 - Tile</p></li>
<li><p>3 - Bitmap</p></li>
<li><p>4 - Sprite</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-0-console">
<h3>Mode 0: Console<a class="headerlink" href="#mode-0-console" title="Permalink to this headline">¶</a></h3>
<p>The console may be rendered on any canvas plane. ANSI color 0-black
is transparent, which makes it easy to show text over a background
image using planes. The console may be a partial screen, but the
scanlines must be a multiple of the font height. 640 pixel wide
canvases use an 8x16 font for 80 columns. 320 pixel wide canvases
use an 8x8 font for 40 columns. Only one console may be visible,
programming again will remove the previous console.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$1:0:01</p></td>
<td><p>MODE</p></td>
<td><p>0 - Console</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:02</p></td>
<td><p>PLANE</p></td>
<td><p>0-2 to select which fill plane of scanlines to program.</p></td>
</tr>
<tr class="row-even"><td><p>$1:0:03</p></td>
<td><p>BEGIN</p></td>
<td><p>First scanline to program. BEGIN &lt;= n &lt; END</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:04</p></td>
<td><p>END</p></td>
<td><p>End of scanlines to program. 0 means use canvas height (180-480).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-1-character">
<h3>Mode 1: Character<a class="headerlink" href="#mode-1-character" title="Permalink to this headline">¶</a></h3>
<p>Character modes have color information for each position on the
screen. This is the mode you want for showing text in different
colors.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$1:0:01</p></td>
<td><p>MODE</p></td>
<td><p>1 - Character</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:02</p></td>
<td><p>OPTIONS</p></td>
<td><div class="line-block">
<div class="line">bit 3 - font size 0=8x8, 1=8x16</div>
<div class="line">bit 2:0 - 0=1, 1=4r, 2=4, 3=8, or 4=16 bit color</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>$1:0:03</p></td>
<td><p>CONFIG</p></td>
<td><p>Address of config structure in XRAM.</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:04</p></td>
<td><p>PLANE</p></td>
<td><p>0-2 to select which fill plane of scanlines to program.</p></td>
</tr>
<tr class="row-even"><td><p>$1:0:05</p></td>
<td><p>BEGIN</p></td>
<td><p>First scanline to program. BEGIN &lt;= n &lt; END</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:06</p></td>
<td><p>END</p></td>
<td><p>End of scanlines to program. 0 means use canvas height
(180-480).</p></td>
</tr>
</tbody>
</table>
<p>Config structure may be updated without reprogramming scanlines.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="n">x_wrap</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">y_wrap</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">x_px</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">y_px</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">width_chars</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">height_chars</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">data_ptr</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">palette_ptr</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">font_ptr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">config</span><span class="p">;</span>
</pre></div>
</div>
<p>Data is encoded based on the color bit depth selected.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// 2-color, 1-bit</span>
<span class="k">struct</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">glyph_code</span><span class="p">;</span>
<span class="p">}</span> <span class="n">data</span><span class="p">[</span><span class="n">width_chars</span> <span class="o">*</span> <span class="n">height_chars</span><span class="p">];</span>
</pre></div>
</div>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// 16-color reversed index, 4-bit</span>
<span class="k">struct</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">glyph_code</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">fg_bg_index</span><span class="p">;</span>
<span class="p">}</span> <span class="n">data</span><span class="p">[</span><span class="n">width_chars</span> <span class="o">*</span> <span class="n">height_chars</span><span class="p">];</span>
</pre></div>
</div>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// 16-color, 4-bit</span>
<span class="k">struct</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">glyph_code</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">bg_fg_index</span><span class="p">;</span>
<span class="p">}</span> <span class="n">data</span><span class="p">[</span><span class="n">width_chars</span> <span class="o">*</span> <span class="n">height_chars</span><span class="p">];</span>
</pre></div>
</div>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// 256-color, 8-bit</span>
<span class="k">struct</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">glyph_code</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">fg_index</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">bg_index</span><span class="p">;</span>
<span class="p">}</span> <span class="n">data</span><span class="p">[</span><span class="n">width_chars</span> <span class="o">*</span> <span class="n">height_chars</span><span class="p">];</span>
</pre></div>
</div>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// 32768-color, 16-bit (no palette)</span>
<span class="k">struct</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">glyph_code</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">attributes</span><span class="p">;</span> <span class="c1">// user defined, ignored by VGA</span>
    <span class="kt">uint16_t</span> <span class="n">fg_color</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">bg_color</span><span class="p">;</span>
<span class="p">}</span> <span class="n">data</span><span class="p">[</span><span class="n">width_chars</span> <span class="o">*</span> <span class="n">height_chars</span><span class="p">];</span>
</pre></div>
</div>
<p>Fonts are encoded in wide format. The first 256 bytes are the first
row of each of the 256 glyphs.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
  <span class="k">struct</span> <span class="p">{</span>
      <span class="kt">uint8_t</span> <span class="n">col</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
  <span class="p">}</span> <span class="n">row</span><span class="p">[</span><span class="n">height</span><span class="p">];</span>
<span class="p">}</span> <span class="n">font</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="mode-2-tile">
<h3>Mode 2: Tile<a class="headerlink" href="#mode-2-tile" title="Permalink to this headline">¶</a></h3>
<p>Tile modes have color information encoded in the tile bitmap. This is
the mode you want for showing a video game playfield. Hi-res canvases
(640x480 and 640x360) support one plane of 1-bit color. Standard
canvases (320x240 and 328x180) support two planes of any option.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$1:0:01</p></td>
<td><p>MODE</p></td>
<td><p>2 - Tile</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:02</p></td>
<td><p>OPTIONS</p></td>
<td><div class="line-block">
<div class="line">bit 3 - 0=8x8, 1=16x16</div>
<div class="line">bit 2:0 - 0=1, 1=2, 2=4, or 3=8 bit color</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>$1:0:03</p></td>
<td><p>CONFIG</p></td>
<td><p>Address of config structure in XRAM.</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:04</p></td>
<td><p>PLANE</p></td>
<td><p>0-2 to select which fill plane of scanlines to program.</p></td>
</tr>
<tr class="row-even"><td><p>$1:0:05</p></td>
<td><p>BEGIN</p></td>
<td><p>First scanline to program. BEGIN &lt;= n &lt; END</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:06</p></td>
<td><p>END</p></td>
<td><p>End of scanlines to program. 0 means use canvas height
(180-480).</p></td>
</tr>
</tbody>
</table>
<p>Config structure may be updated without reprogramming scanlines.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="n">x_wrap</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">y_wrap</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">x_px</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">y_px</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">width_tiles</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">height_tiles</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">data_ptr</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">palette_ptr</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">tile_ptr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">config</span><span class="p">;</span>
</pre></div>
</div>
<p>Data is a matrix of tile ids with 0,0 at the top left.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">tile_id</span><span class="p">;</span>
<span class="p">}</span> <span class="n">data</span><span class="p">[</span><span class="n">width_tiles</span> <span class="o">*</span> <span class="n">height_tiles</span><span class="p">];</span>
</pre></div>
</div>
<p>Tiles are encoded in “tall” bitmap format.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="c1">// 8x8 tiles</span>
<span class="k">struct</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="p">{</span>
        <span class="kt">uint8_t</span> <span class="n">cols</span><span class="p">[</span><span class="n">bpp</span><span class="p">];</span>
    <span class="p">}</span> <span class="n">rows</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">}</span> <span class="n">tile</span><span class="p">[</span><span class="n">up_to_256</span><span class="p">];</span>

<span class="c1">// 16x16 tiles</span>
<span class="k">struct</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="p">{</span>
        <span class="kt">uint8_t</span> <span class="n">cols</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">bpp</span><span class="p">];</span>
    <span class="p">}</span> <span class="n">rows</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="p">}</span> <span class="n">tile</span><span class="p">[</span><span class="n">up_to_256</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="section" id="mode-3-bitmap">
<h3>Mode 3: Bitmap<a class="headerlink" href="#mode-3-bitmap" title="Permalink to this headline">¶</a></h3>
<p>Every pixel can be its own color. 64K XRAM limits the full screen
color depth. Monochrome at 640x480, 16 colors at 320x240, 256 colors
for 320x180 (16:9).</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$1:0:01</p></td>
<td><p>MODE</p></td>
<td><p>3 - Bitmap</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:02</p></td>
<td><p>OPTIONS</p></td>
<td><div class="line-block">
<div class="line">bit 3 - reverse bit order</div>
<div class="line">bit 2:0 - 0=1, 1=2, 2=4, 3=8, or 4=16 bit color</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>$1:0:03</p></td>
<td><p>CONFIG</p></td>
<td><p>Address of config structure in XRAM.</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:04</p></td>
<td><p>PLANE</p></td>
<td><p>0-2 to select which fill plane of scanlines to program.</p></td>
</tr>
<tr class="row-even"><td><p>$1:0:05</p></td>
<td><p>BEGIN</p></td>
<td><p>First scanline to program. BEGIN &lt;= n &lt; END</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:06</p></td>
<td><p>END</p></td>
<td><p>End of scanlines to program. 0 means use canvas height
(180-480).</p></td>
</tr>
</tbody>
</table>
<p>Config structure may be updated without reprogramming scanlines.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
    <span class="kt">bool</span> <span class="n">x_wrap</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">y_wrap</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">x_px</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">y_px</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">width_px</span><span class="p">;</span>
    <span class="kt">int16_t</span> <span class="n">height_px</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">data_ptr</span><span class="p">;</span>
    <span class="kt">uint16_t</span> <span class="n">palette_ptr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">config</span><span class="p">;</span>
</pre></div>
</div>
<p>Data is the color information packed down to the bit level. 16-bit
color encodes the color directly as data. 1, 4, and 8 bit color
encodes a palette index as data.</p>
<p>Bit order is traditionally done so that left and right bit shift
operations match pixel movement on screen. The reverse bits option
change the bit order of 1 and 4 bit modes so bit-level manipulation
code is slightly faster and smaller.</p>
<p>Data for 16 bit color must be 16 bit aligned.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="p">{</span>
        <span class="kt">uint8_t</span> <span class="n">cols</span><span class="p">[(</span><span class="n">width_px</span> <span class="o">*</span> <span class="n">bit_depth</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">];</span>
    <span class="p">}</span> <span class="n">rows</span><span class="p">[</span><span class="n">height_px</span><span class="p">];</span>
<span class="p">}</span> <span class="n">data</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="mode-4-sprite">
<h3>Mode 4: Sprite<a class="headerlink" href="#mode-4-sprite" title="Permalink to this headline">¶</a></h3>
<p>Sprites may be drawn over each fill plane. This is the 16-bit sprite
system from the Pi Pico Playground. Lower bit depths are planned for
a different mode.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$1:0:01</p></td>
<td><p>MODE</p></td>
<td><p>4 - Sprite</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:02</p></td>
<td><p>OPTIONS</p></td>
<td><div class="line-block">
<div class="line">bit 1 - affine</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>$1:0:03</p></td>
<td><p>CONFIG</p></td>
<td><div class="line-block">
<div class="line">Address of config array in XRAM.</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>$1:0:04</p></td>
<td><p>LENGTH</p></td>
<td><p>Length of config array array in XRAM.</p></td>
</tr>
<tr class="row-even"><td><p>$1:0:05</p></td>
<td><p>PLANE</p></td>
<td><p>0-2 to select which sprite plane of scanlines to program.</p></td>
</tr>
<tr class="row-odd"><td><p>$1:0:06</p></td>
<td><p>BEGIN</p></td>
<td><p>First scanline to program. BEGIN &lt;= n &lt; END</p></td>
</tr>
<tr class="row-even"><td><p>$1:0:07</p></td>
<td><p>END</p></td>
<td><p>End of scanlines to program. 0 means use canvas height
(180-480).</p></td>
</tr>
</tbody>
</table>
<p>Unused sprites should be moved off screen. Non-affine sprites use this
config structure.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
  <span class="kt">int16_t</span> <span class="n">x_pos_px</span><span class="p">;</span>
  <span class="kt">int16_t</span> <span class="n">y_pos_px</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">xram_sprite_ptr</span><span class="p">;</span>
  <span class="kt">uint8_t</span> <span class="n">log_size</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">has_opacity_metadata</span><span class="p">;</span>
<span class="p">}</span> <span class="n">config</span><span class="p">[</span><span class="n">LENGTH</span><span class="p">];</span>
</pre></div>
</div>
<p>Affine sprites apply a 3x3 matrix transform. These are slower than
plain sprites. Only the first two rows of the matrix is useful, which
is why there’s only six transform values. These are in signed 8.8
fixed point format.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
  <span class="kt">int16_t</span> <span class="n">transform</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
  <span class="kt">int16_t</span> <span class="n">x_pos_px</span><span class="p">;</span>
  <span class="kt">int16_t</span> <span class="n">y_pos_px</span><span class="p">;</span>
  <span class="kt">uint16_t</span> <span class="n">xram_sprite_ptr</span><span class="p">;</span>
  <span class="kt">uint8_t</span> <span class="n">log_size</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">has_opacity_metadata</span><span class="p">;</span>
<span class="p">}</span> <span class="n">config</span><span class="p">[</span><span class="n">LENGTH</span><span class="p">];</span>
</pre></div>
</div>
<p>Sprite image data is an array of 16 bit colors.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="p">{</span>
  <span class="k">struct</span> <span class="p">{</span>
      <span class="kt">uint16_t</span> <span class="n">color</span><span class="p">[</span><span class="mi">2</span><span class="o">^</span><span class="n">log_size</span><span class="p">];</span>
  <span class="p">}</span> <span class="n">rows</span><span class="p">[</span><span class="mi">2</span><span class="o">^</span><span class="n">log_size</span><span class="p">];</span>
<span class="p">}</span> <span class="n">sprite</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="control-channel-f">
<h3>Control Channel $F<a class="headerlink" href="#control-channel-f" title="Permalink to this headline">¶</a></h3>
<p>These registers are managed by the RIA. Do not distribute applications
that set these.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$1:F:00</p></td>
<td><p>DISPLAY</p></td>
<td><p>This sets the aspect ratio of your display. This also resets
CANVAS to the console.</p>
<ul class="simple">
<li><p>0 - VGA (4:3) 640x480</p></li>
<li><p>1 - HD (16:9) 640x480 and 1280x720</p></li>
<li><p>2 - SXGA (5:4) 1280x1024</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>$1:F:01</p></td>
<td><p>CODE_PAGE</p></td>
<td><p>Set code page for built-in font.</p></td>
</tr>
<tr class="row-even"><td><p>$1:F:02</p></td>
<td><p>UART</p></td>
<td><p>Set bit rate. Reserved, not implemented.</p></td>
</tr>
<tr class="row-odd"><td><p>$1:F:03</p></td>
<td><p>UART_TX</p></td>
<td><p>Alternate path for UART Tx when using backchannel.</p></td>
</tr>
<tr class="row-even"><td><p>$1:F:04</p></td>
<td><p>BACKCHAN</p></td>
<td><p>Control using UART Tx as backchannel.</p>
<ul class="simple">
<li><p>0 - Disable</p></li>
<li><p>1 - Enable</p></li>
<li><p>2 - Request</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="backchannel">
<h2>Backchannel<a class="headerlink" href="#backchannel" title="Permalink to this headline">¶</a></h2>
<p>Because the PIX bus is unidirectional, it can’t be used for sending
data from the VGA system back to the RIA. Using the UART Rx path is
undesirable since there would be framing overhead or unusable control
characters. Since there is a lot of unused bandwidth on the PIX bus,
which is only used when the 6502 is writing to XRAM, it can be used
for the UART Tx path allowing the UART Tx pin to switch directions.</p>
<p>This is not interesting to the 6502 programmer as it happens
automatically. It is documented mainly for the hardware explorers
who might be probing UART Tx.</p>
<p>Values 0x00 to 0x7F are used to send a version string as ASCII
terminated with a 0x0D or 0x0A. This must be sent immediately after
the backchannel enable message is received for it to be displayed as
part of the boot message. It may be updated any time after that and
inspected with the <code class="docutils literal notranslate"><span class="pre">status</span></code> monitor command, but currently there is
no reason to do so.</p>
<p>When bit 0x80 is set, the 0x70 bits indicate the command type, and the
0x0F bits are a scalar for the command.</p>
<p>0x80 VSYNC - The scalar will increment and be used for the LSB of the
RIA_VSYNC register.</p>
<p>0x90 OP_ACK - Some XREG locations are triggers for remote calls which
may fail or take time to complete. This acknowledges a successful
completion.</p>
<p>0xA0 OP_NAK - This acknowledges a failure.</p>
</div>
<div class="section" id="terminal">
<h2>Terminal<a class="headerlink" href="#terminal" title="Permalink to this headline">¶</a></h2>
<p>The RP6502 VGA system includes a color ANSI terminal attached as the
console. This terminal does not require flow control to keep up with
115200 bps.</p>
<div class="section" id="c0-control-codes">
<h3>C0 control codes<a class="headerlink" href="#c0-control-codes" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 80%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>^</p></th>
<th class="head"><p>C0</p></th>
<th class="head"><p>Abbr</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Effect</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>^H</p></td>
<td><p>0x08</p></td>
<td><p>BS</p></td>
<td><p>Backspace</p></td>
<td><p>Move cursor left.</p></td>
</tr>
<tr class="row-odd"><td><p>^I</p></td>
<td><p>0x09</p></td>
<td><p>HT</p></td>
<td><p>Tab</p></td>
<td><p>Move cursor right to multiple of 8 column.</p></td>
</tr>
<tr class="row-even"><td><p>^J</p></td>
<td><p>0x0A</p></td>
<td><p>LF</p></td>
<td><p>Line Feed</p></td>
<td><p>Move to next line.</p></td>
</tr>
<tr class="row-odd"><td><p>^L</p></td>
<td><p>0x0C</p></td>
<td><p>FF</p></td>
<td><p>Form Feed</p></td>
<td><p>Clear screen and move cursor to top row.</p></td>
</tr>
<tr class="row-even"><td><p>^M</p></td>
<td><p>0x0D</p></td>
<td><p>CR</p></td>
<td><p>Carriage Return</p></td>
<td><p>Move cursor to first column.</p></td>
</tr>
<tr class="row-odd"><td><p>^[</p></td>
<td><p>0x1B</p></td>
<td><p>ESC</p></td>
<td><p>Escape</p></td>
<td><p>Start an escape sequence.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="fe-escape-sequences">
<h3>Fe Escape Sequences<a class="headerlink" href="#fe-escape-sequences" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Code</p></th>
<th class="head"><p>Abbr</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Effect</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ESC [</p></td>
<td><p>CSI</p></td>
<td><p>Control Sequence Inducer</p></td>
<td><p>Begins most of the interesting sequences.</p></td>
</tr>
<tr class="row-odd"><td><p>ESC N</p></td>
<td><p>SS2</p></td>
<td><p>Single Shift Two</p></td>
<td><p>No SS2 commands implemented.</p></td>
</tr>
<tr class="row-even"><td><p>ESC O</p></td>
<td><p>SS3</p></td>
<td><p>Single Shift Three</p></td>
<td><p>No SS3 commands implemented.</p></td>
</tr>
<tr class="row-odd"><td><p>ESC c</p></td>
<td><p>RIS</p></td>
<td><p>Reset to Initial State</p></td>
<td><p>Completely resets the terminal.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="csi-sequences">
<h3>CSI Sequences<a class="headerlink" href="#csi-sequences" title="Permalink to this headline">¶</a></h3>
<p>Missing numbers are treated as 0. Some functions, like cursor
movement, treat 0 as 1 to be useful without parameters.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Code</p></th>
<th class="head"><p>Abbr</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Effect</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CSI n A</p></td>
<td><p>CUU</p></td>
<td><p>Cursor Up</p></td>
<td><p>Move the cursor n cells up.</p></td>
</tr>
<tr class="row-odd"><td><p>CSI n B</p></td>
<td><p>CUD</p></td>
<td><p>Cursor Down</p></td>
<td><p>Move the cursor n cells down.</p></td>
</tr>
<tr class="row-even"><td><p>CSI n C</p></td>
<td><p>CUF</p></td>
<td><p>Cursor Forward</p></td>
<td><p>Move the cursor n cells right.</p></td>
</tr>
<tr class="row-odd"><td><p>CSI n D</p></td>
<td><p>CUB</p></td>
<td><p>Cursor Back</p></td>
<td><p>Move the cursor n cells left.</p></td>
</tr>
<tr class="row-even"><td><p>CSI n P</p></td>
<td><p>DCH</p></td>
<td><p>Delete Character</p></td>
<td><p>Delete n cells, move line left.</p></td>
</tr>
<tr class="row-odd"><td><p>CSI n ; m H</p></td>
<td><p>CUP</p></td>
<td><p>Cursor Position</p></td>
<td><p>Move the cursor to row n column m. 1-indexed.</p></td>
</tr>
<tr class="row-even"><td><p>CSI n J</p></td>
<td><p>ED</p></td>
<td><p>Erase in Display</p></td>
<td><ul class="simple">
<li><p>0: Erases from the cursor position to the end of the
screen.</p></li>
<li><p>1: Erases from the beginning of the screen to the cursor
position.</p></li>
<li><p>2, 3: Erases the entire screen.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>CSI n K</p></td>
<td><p>EL</p></td>
<td><p>Erase in Line</p></td>
<td><ul class="simple">
<li><p>0: Erases from the cursor position to the end of the line.</p></li>
<li><p>1: Erases from the beginning of the line to the cursor
position.</p></li>
<li><p>2: Erases the entire line.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>CSI n m</p></td>
<td><p>SGR</p></td>
<td><p>Select Graphic Rendition</p></td>
<td><p>Selects colors and styles.</p></td>
</tr>
<tr class="row-odd"><td><p>CSI 6n</p></td>
<td><p>DSR</p></td>
<td><p>Device Status Report</p></td>
<td><p>Responds with the cursor position (CPR) ESC[n;mR, where n is
the row and m is the column. 1-indexed.</p></td>
</tr>
<tr class="row-even"><td><p>CSI s</p></td>
<td><p>SCP</p></td>
<td><p>Save Current Cursor Position</p></td>
<td><p>Save cursor row and col for retrieval with RCP.</p></td>
</tr>
<tr class="row-odd"><td><p>CSI u</p></td>
<td><p>RCP</p></td>
<td><p>Restore Saved Cursor Position</p></td>
<td><p>Moves cursor to position stored by SCP.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="sgr-parameters">
<h3>SGR Parameters<a class="headerlink" href="#sgr-parameters" title="Permalink to this headline">¶</a></h3>
<p>Multiple parameters may be sent separated by semicolons. Reset is
performed if no codes (CSI m).</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 20%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>n</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Effect</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>Reset or normal</p></td>
<td><p>White (7) foreground, black (0) background.</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>Bold intensity</p></td>
<td><p>Brighter foreground colors. Colors 0-7 brightened.</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>Blink</p></td>
<td><p>Some ANSI art uses this to brighten the background color.
It’s a quirk of ANSI.SYS on IBM VGA.</p></td>
</tr>
<tr class="row-odd"><td><p>22</p></td>
<td><p>Normal intensity</p></td>
<td><p>Normal foreground colors. Colors 8-15 dimmed.</p></td>
</tr>
<tr class="row-even"><td><p>25</p></td>
<td><p>Blink off</p></td>
<td><p>Returns to normal intensity background.</p></td>
</tr>
<tr class="row-odd"><td><p>30-37</p></td>
<td><p>Set foreground color</p></td>
<td><p>Colors 0-7</p></td>
</tr>
<tr class="row-even"><td><p>38</p></td>
<td><p>Set foreground color</p></td>
<td><p>Followed by 1 or 5;n or 2;r;g;b or 2::r:g:b</p></td>
</tr>
<tr class="row-odd"><td><p>39</p></td>
<td><p>Default foreground color</p></td>
<td><p>Color 7 white.</p></td>
</tr>
<tr class="row-even"><td><p>40-47</p></td>
<td><p>Set background color</p></td>
<td><p>Colors 0-7</p></td>
</tr>
<tr class="row-odd"><td><p>48</p></td>
<td><p>Set background color</p></td>
<td><p>Followed by 1 or 5;n or 2;r;g;b or 2::r:g:b</p></td>
</tr>
<tr class="row-even"><td><p>49</p></td>
<td><p>Default background color</p></td>
<td><p>Color 0 transparent black.</p></td>
</tr>
<tr class="row-odd"><td><p>90-97</p></td>
<td><p>Set bright foreground color</p></td>
<td><p>Colors 8-15</p></td>
</tr>
<tr class="row-even"><td><p>100-107</p></td>
<td><p>Set bright background color</p></td>
<td><p>Colors 8-15</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="ria_w.html" title="Previous document">RP6502-RIA-W</a>
        </li>
        <li>
          <a href="os.html" title="Next document">RP6502-OS</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2025 Rumbledethumps.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/vga.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/picocomputer/" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>