
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>RP6502-VGA &#8212; RP6502 0.0-pre documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="RP6502-API" href="api.html" />
    <link rel="prev" title="RP6502-RIA" href="ria.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="rp6502-vga">
<h1>RP6502-VGA<a class="headerlink" href="#rp6502-vga" title="Permalink to this headline">¶</a></h1>
<p>Rumbledethumps Picocomputer 6502 Video Graphics Array.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">1. Introduction</a></p></li>
<li><p><a class="reference internal" href="#video-programming" id="id2">2. Video Programming</a></p>
<ul>
<li><p><a class="reference internal" href="#mode-0-console" id="id3">Mode 0: Console</a></p></li>
<li><p><a class="reference internal" href="#mode-1-2-character-8x8-8x16" id="id4">Mode 1-2: Character 8x8 &amp; 8x16</a></p></li>
<li><p><a class="reference internal" href="#mode-3-4-tile-8x8-16x16" id="id5">Mode 3-4: Tile 8x8 &amp; 16x16</a></p></li>
<li><p><a class="reference internal" href="#mode-5-bitmap" id="id6">Mode 5: Bitmap</a></p></li>
<li><p><a class="reference internal" href="#mode-6-sprite" id="id7">Mode 6: Sprite</a></p></li>
<li><p><a class="reference internal" href="#mode-7-affine-sprite" id="id8">Mode 7: Affine Sprite</a></p></li>
<li><p><a class="reference internal" href="#control-channel-f" id="id9">Control Channel $F</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The Video Graphics Array is a Raspberry Pi Pico with RP6502-VGA firmware. Its primary connection is to a <a class="reference internal" href="ria.html"><span class="doc">RP6502-RIA</span></a> over a 5-wire PIX bus. More than one VGA module can be put on a PIX bus. Note that all VGA modules share the same 64K of XRAM and only one module can generate frame numbers and vsync interrupts.</p>
</div>
<div class="section" id="video-programming">
<h2><a class="toc-backref" href="#id2">2. Video Programming</a><a class="headerlink" href="#video-programming" title="Permalink to this headline">¶</a></h2>
<p>This is the current implementation. This is leftovers from validating the PIX bus. The bitmap modes are 4 bpp starting at VRAM 0x0000 with a fixed palette of ANSI colors.</p>
<blockquote>
<div><table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$0:00</p></td>
<td><p>MODE</p></td>
<td><dl class="simple">
<dt>Select a graphics mode.</dt><dd><ul class="simple">
<li><p>0 - 80 Column Terminal mode.</p></li>
<li><p>1 - 320x240 16 colors (4:3)</p></li>
<li><p>2 - 320x180 16 colors (16:9)</p></li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>$F:FF</p></td>
<td><p>RESET</p></td>
<td><p>Always returns to terminal mode.</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The following is a new design being worked on. It only exists in the “vga” branch.</p>
<p>The design philosophy for the VGA system is to enable the full power of the Pi Pico while maintaining some 8-bit purity. To that end, it can do affine transforms (mode 7) but is limited to working from 64K of extended memory (XRAM).</p>
<p>The VGA system is built around the scanvideo library from Pi Pico Extras. The color arrangement is identical to their demo board reference design, so sprites and other creations for the Pi Pico have a very good chance of working. This design uses the 16th color bit to render three planes with transparency. The sprite system is from Pi Pico Playground. The RP6502 VGA system exposes per-scanline configuration of these libraries from a 6502 application.</p>
<p>Each scanline has three fill planes. Two sprite layers can be drawn over each fill plane. If you draw too much, the screen will become half-blue. The VGA engine will begin rendering with scanline 0. It first renders fill plane 0 if a fill mode is programmed. Fill planes require modes that fill all pixels, like character and bitmap modes. If no fill plane is programmed, and sprites need to be rendered for this plane, a line of transparent black is automatically rendered (which takes time). Sprites are drawn over their fill plane, in order, over each other using the transparent bit. The process repeats for each fill plane, then repeats for each scanline.</p>
<p>Programming the VGA device should be done with the SDK system calls. These PIX registers are for reference and not yet stable. VGA is PIX device ID 1. VGA PIX extended register addresses store 16 bit values and are specified by $channel:register. e.g. $0:0F</p>
<p>The built-in 8x8 and 8x16 fonts are available by using the special XRAM pointer $FFFF. Glyphs 0-127 are ASCII, glyphs 128-255 vary depending on the code page selected.</p>
<p>The built-in color palettes are accessed by using the special XRAM pointer $FFFF. 1-bit is black and white. 2, 4, and 8-bits point to an ANSI color palette. This is defined as 16 colors, followed by 216 colors (6x6x6), followed by 24 greys.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$0:00</p></td>
<td><p>VSYNC</p></td>
<td><p>Select which scanline number increments the frame counter and fires the optional IRQ.</p></td>
</tr>
<tr class="row-odd"><td><p>$0:01</p></td>
<td><p>CANVAS</p></td>
<td><dl class="simple">
<dt>Select a graphics canvas. This clears $0:03-$0:FF and all scanline programming. The 80 column console is used as a failsafe and therefore not scanline programmable.</dt><dd><ul class="simple">
<li><p>0 - 80 column console. (4:3 or 5:4)</p></li>
<li><p>1 - 320x240 (4:3)</p></li>
<li><p>2 - 320x180 (16:9)</p></li>
<li><p>3 - 640x480 (4:3)</p></li>
<li><p>4 - 640x360 (16:9)</p></li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-even"><td><p>$0:02</p></td>
<td><p>MODE</p></td>
<td><dl class="simple">
<dt>Program a mode into a plane of scanlines. $0:03-$0:FF cleared after programming.</dt><dd><ul class="simple">
<li><p>0 - Console, ANSI Terminal</p></li>
<li><p>1 - Character 8x8</p></li>
<li><p>2 - Character 8x16</p></li>
<li><p>3 - Tile 8x8</p></li>
<li><p>4 - Tile 16x16</p></li>
<li><p>5 - Bitmap</p></li>
<li><p>6 - Sprite</p></li>
<li><p>7 - Affine Sprite</p></li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>$0:03</p></td>
<td><p>PLANE</p></td>
<td><p>0-3 to select which fill plane of scanlines to program.</p></td>
</tr>
<tr class="row-even"><td><p>$0:04</p></td>
<td><p>SLBEGIN</p></td>
<td><p>First scanline to program. SLBEGIN &lt;= n &lt; SLEND</p></td>
</tr>
<tr class="row-odd"><td><p>$0:05</p></td>
<td><p>SLEND</p></td>
<td><p>End of scanlines to program. 0 means use max y resolution (180-480).</p></td>
</tr>
</tbody>
</table>
<div class="section" id="mode-0-console">
<h3><a class="toc-backref" href="#id3">Mode 0: Console</a><a class="headerlink" href="#mode-0-console" title="Permalink to this headline">¶</a></h3>
<p>There are no mode specific registers for the console. Programming the console for a partial screen will align the bottom row on the last scanline. The background is transparent, which makes it easy to show text over a background image using planes.</p>
</div>
<div class="section" id="mode-1-2-character-8x8-8x16">
<h3><a class="toc-backref" href="#id4">Mode 1-2: Character 8x8 &amp; 8x16</a><a class="headerlink" href="#mode-1-2-character-8x8-8x16" title="Permalink to this headline">¶</a></h3>
<p>Character modes have color information for each position on the screen. This is the mode you want for showing text in different colors.</p>
<p>Fonts are encoded in wide format. The first 256 bytes are the first row of 256 glyphs. This is the fastest layout, but wastes memory when not using the entire character set.</p>
<p>TODO: c, c(fb), cfb, (cc)(ff)(bb)</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$0:06</p></td>
<td><p>COLORS</p></td>
<td><p>2^(n+1) = 2, 4, 8, or 16 bit color</p></td>
</tr>
<tr class="row-odd"><td><p>$0:07</p></td>
<td><p>WRAP</p></td>
<td><div class="line-block">
<div class="line">bit 7 - wrapx</div>
<div class="line">bit 6 - wrapy</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>$0:08</p></td>
<td><p>STRUCT</p></td>
<td><div class="line-block">
<div class="line">Pointer to config structure in XRAM.</div>
<div class="line">{</div>
<div class="line-block">
<div class="line">int16_t xpos_px</div>
<div class="line">int16_t ypos_px</div>
<div class="line">int16_t width_chars</div>
<div class="line">int16_t height_chars</div>
<div class="line">uint16_t data_xram_ptr</div>
<div class="line">uint16_t color_table_xram_ptr</div>
<div class="line">uint16_t font_xram_ptr</div>
</div>
<div class="line">}</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-3-4-tile-8x8-16x16">
<h3><a class="toc-backref" href="#id5">Mode 3-4: Tile 8x8 &amp; 16x16</a><a class="headerlink" href="#mode-3-4-tile-8x8-16x16" title="Permalink to this headline">¶</a></h3>
<p>Tile modes have color information encoded with the tiles. This is the mode you want for showing a video game playfield.</p>
<p>Tiles are encoded in tall format. The first bytes are the entire first glyph. The 16x16 mode also supports WCHAR for more than 256 characters, as memory permits.</p>
<p>TODO: b, ff, (ff), (ffff)</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$0:06</p></td>
<td><p>COLORS</p></td>
<td><p>2^(n+1) = 2, 4, 8, or 16 bit color</p></td>
</tr>
<tr class="row-odd"><td><p>$0:07</p></td>
<td><p>WRAP</p></td>
<td><div class="line-block">
<div class="line">bit 7 - wrapx</div>
<div class="line">bit 6 - wrapy</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>$0:08</p></td>
<td><p>STRUCT</p></td>
<td><div class="line-block">
<div class="line">Pointer to config structure in XRAM.</div>
<div class="line">{</div>
<div class="line-block">
<div class="line">int16_t xpos_px</div>
<div class="line">int16_t ypos_px</div>
<div class="line">int16_t width_px</div>
<div class="line">int16_t height_px</div>
<div class="line">uint16_t data_xram_ptr</div>
<div class="line">uint16_t color_table_xram_ptr</div>
<div class="line">uint16_t tile_xram_ptr</div>
</div>
<div class="line">}</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-5-bitmap">
<h3><a class="toc-backref" href="#id6">Mode 5: Bitmap</a><a class="headerlink" href="#mode-5-bitmap" title="Permalink to this headline">¶</a></h3>
<p>Every pixel can be its own color. 64K XRAM has limits. Monochrome for 640x480, 256 color for 320x180, and 16 colors on 320x240.</p>
<p>TODO b, ff, (ff), (ffff)</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$0:06</p></td>
<td><p>COLORS</p></td>
<td><p>2^(n+1) = 2, 4, 8, or 16 bit color</p></td>
</tr>
<tr class="row-odd"><td><p>$0:07</p></td>
<td><p>WRAP</p></td>
<td><div class="line-block">
<div class="line">bit 7 - wrapx</div>
<div class="line">bit 6 - wrapy</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>$0:08</p></td>
<td><p>STRUCT</p></td>
<td><div class="line-block">
<div class="line">Pointer to config structure in XRAM.</div>
<div class="line">{</div>
<div class="line-block">
<div class="line">int16_t xpos_px</div>
<div class="line">int16_t ypos_px</div>
<div class="line">int16_t width_px</div>
<div class="line">int16_t height_px</div>
<div class="line">uint16_t data_xram_ptr</div>
<div class="line">uint16_t color_table_xram_ptr</div>
</div>
<div class="line">}</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-6-sprite">
<h3><a class="toc-backref" href="#id7">Mode 6: Sprite</a><a class="headerlink" href="#mode-6-sprite" title="Permalink to this headline">¶</a></h3>
<p>Sprite images are log-sized (1x1, 2x2, 4x4, 8x8, etc.) arrays of 16-colors pixel data.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$0:06</p></td>
<td><p>LAYER</p></td>
<td><p>0-1 Two sprite layers plane.</p></td>
</tr>
<tr class="row-odd"><td><p>$0:07</p></td>
<td><p>LENGTH</p></td>
<td><p>Length of sprite structure array in XRAM.</p></td>
</tr>
<tr class="row-even"><td><p>$0:08</p></td>
<td><p>STRUCT</p></td>
<td><div class="line-block">
<div class="line">Pointer to config structure array in XRAM.</div>
<div class="line">{</div>
<div class="line-block">
<div class="line">int16_t xpos_px</div>
<div class="line">int16_t ypos_px</div>
<div class="line">int16_t img_xram_ptr</div>
<div class="line">uint8_t log_size;</div>
<div class="line">bool has_opacity_metadata;</div>
</div>
<div class="line">}</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mode-7-affine-sprite">
<h3><a class="toc-backref" href="#id8">Mode 7: Affine Sprite</a><a class="headerlink" href="#mode-7-affine-sprite" title="Permalink to this headline">¶</a></h3>
<p>Affine sprites apply a 3x3 matrix transform. These are slower than plain sprites. Only the first two rows of the matrix is useful, which is why there’s only six transform values. These are in signed 8.8 fixed point format.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$0:06</p></td>
<td><p>LAYER</p></td>
<td><p>0-1 Two sprite layers plane.</p></td>
</tr>
<tr class="row-odd"><td><p>$0:07</p></td>
<td><p>LENGTH</p></td>
<td><p>Length of sprite structure array in XRAM.</p></td>
</tr>
<tr class="row-even"><td><p>$0:08</p></td>
<td><p>STRUCT</p></td>
<td><div class="line-block">
<div class="line">Pointer to config structure array in XRAM.</div>
<div class="line">{</div>
<div class="line-block">
<div class="line">int16_t transform[6];</div>
<div class="line">int16_t xpos_px</div>
<div class="line">int16_t ypos_px</div>
<div class="line">int16_t img_xram_ptr</div>
<div class="line">uint8_t log_size;</div>
<div class="line">bool has_opacity_metadata;</div>
</div>
<div class="line">}</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="control-channel-f">
<h3><a class="toc-backref" href="#id9">Control Channel $F</a><a class="headerlink" href="#control-channel-f" title="Permalink to this headline">¶</a></h3>
<p>These registers are managed by the RIA. Display and code page are settings. The backchannel is an internal resource.</p>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$F:00</p></td>
<td><p>DISPLAY</p></td>
<td><dl class="simple">
<dt>This sets the aspect ratio of your display. Use CANVAS to select the resolution the 6502 works with.</dt><dd><ul class="simple">
<li><p>0 - VGA (4:3) 640x480</p></li>
<li><p>1 - HD (16:9) 640x480 and 1280x720</p></li>
<li><p>2 - SXGA (5:4) 1280x1024</p></li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>$F:01</p></td>
<td><p>CODEPAGE</p></td>
<td><p>Select code page for built-in font.</p></td>
</tr>
<tr class="row-even"><td><p>$F:02</p></td>
<td><p>STDOUT</p></td>
<td><p>Alternate path for UART Tx when using backchannel.</p></td>
</tr>
<tr class="row-odd"><td><p>$F:03</p></td>
<td><p>BACKCHANREQ</p></td>
<td><p>Request UART Tx switch over to backchannel.</p></td>
</tr>
<tr class="row-even"><td><p>$F:04</p></td>
<td><p>BACKCHANACK</p></td>
<td><p>Acknowledge UART Tx switch over to backchannel.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">RP6502</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hardware.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="ria.html">RIA</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">VGA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#video-programming">2. Video Programming</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mode-0-console">Mode 0: Console</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mode-1-2-character-8x8-8x16">Mode 1-2: Character 8x8 &amp; 8x16</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mode-3-4-tile-8x8-16x16">Mode 3-4: Tile 8x8 &amp; 16x16</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mode-5-bitmap">Mode 5: Bitmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mode-6-sprite">Mode 6: Sprite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mode-7-affine-sprite">Mode 7: Affine Sprite</a></li>
<li class="toctree-l3"><a class="reference internal" href="#control-channel-f">Control Channel $F</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="ria.html" title="previous chapter">RP6502-RIA</a></li>
      <li>Next: <a href="api.html" title="next chapter">RP6502-API</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023 Rumbledethumps.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/vga.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>