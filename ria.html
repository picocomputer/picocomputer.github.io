
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>RP6502-RIA &#8212; RP6502 0.0-pre documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="RP6502-VGA" href="vga.html" />
    <link rel="prev" title="Picocomputer 6502" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="rp6502-ria">
<h1>RP6502-RIA<a class="headerlink" href="#rp6502-ria" title="Permalink to this headline">¶</a></h1>
<p>Rumbledethumps Picocomputer 6502 Interface Adapter.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id2">1. Introduction</a></p>
<ul>
<li><p><a class="reference internal" href="#features-of-the-rp6502-ria" id="id3">1.1. Features of the RP6502-RIA</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#functional-description" id="id4">2. Functional Description</a></p>
<ul>
<li><p><a class="reference internal" href="#reset" id="id5">2.1. Reset</a></p></li>
<li><p><a class="reference internal" href="#registers" id="id6">2.2. Registers</a></p></li>
<li><p><a class="reference internal" href="#uart" id="id7">2.3. UART</a></p></li>
<li><p><a class="reference internal" href="#extended-ram-xram" id="id8">2.4. Extended RAM (XRAM)</a></p></li>
<li><p><a class="reference internal" href="#extended-stack-xstack" id="id9">2.5. Extended Stack (XSTACK)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#pico-information-exchange-pix" id="id10">3. Pico Information Exchange (PIX)</a></p>
<ul>
<li><p><a class="reference internal" href="#physical-layer" id="id11">3.1. Physical layer</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id12">3.2. Extended RAM (XRAM)</a></p></li>
<li><p><a class="reference internal" href="#pix-registers-xreg" id="id13">3.3. PIX Registers (XREG)</a></p></li>
<li><p><a class="reference internal" href="#pix-halt" id="id14">3.4. PIX Halt</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#fm-audio-synthesizer" id="id15">4. FM Audio Synthesizer</a></p></li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id2">1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The RP6502 Interface Adapter (RIA) is a Raspberry Pi Pico with RP6502-RIA firmware. The RIA provides all essential services to support a WDC W65C02S microprocessor.</p>
<div class="section" id="features-of-the-rp6502-ria">
<h3><a class="toc-backref" href="#id3">1.1. Features of the RP6502-RIA</a><a class="headerlink" href="#features-of-the-rp6502-ria" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Advanced CMOS process technology for low power consumption</p></li>
<li><p>Reset and clock management</p></li>
<li><p>ROM loader</p></li>
<li><p>UART</p></li>
<li><p>Stereo audio</p></li>
<li><p>USB MSC - Hard drives and flash drives</p></li>
<li><p>USB HID - Keyboards, mice, and game controllers</p></li>
<li><p>PIX bus for GPUs like the RP6502-VGA</p></li>
</ul>
</div>
</div>
<div class="section" id="functional-description">
<h2><a class="toc-backref" href="#id4">2. Functional Description</a><a class="headerlink" href="#functional-description" title="Permalink to this headline">¶</a></h2>
<p>The RIA must be installed at $FFE0-$FFFF and must be in control of RESB and PHI2. These are the only requirements. Everything else about your Picocomputer can be customized.</p>
<p>A new RIA will boot to the the kernel CLI. This CLI can be accessed from VGA and keyboard, or from the serial console. The kernel CLI is not currently documented here. The built-in help is extensive and always up-to-date. Type ‘help’.</p>
<p>The kernel CLI can be used in two ways. There are commands to install ROM files to the RIA EEPROM which can boot on power up. You may also use the CLI to load programs from a USB drive or development system.</p>
<div class="section" id="reset">
<h3><a class="toc-backref" href="#id5">2.1. Reset</a><a class="headerlink" href="#reset" title="Permalink to this headline">¶</a></h3>
<p>When the 6502 is in reset, meaning RESB is low and it is not running, the kernel CLI is available for use. If the 6502 has stopped running or the current application has no way to exit, you can put the 6502 back into reset in two ways.</p>
<p>Using a USB keyboard, press CTRL-ALT-DEL. The USB stack runs on the Pi Pico so this will work even if the 6502 has crashed.</p>
<p>Over the UART, send a break. This can be used by a build system to upload and test programs.</p>
<p>MacOS currently can not send a break using the RP6502-VGA due to a known issue with TinyUSB.</p>
<p>WARNING! Do not hook up a physical button to RESB. If you really need one for some reason, have the button pull UART RX low (a break). But what you probably want is the reset that happens from the RUN pin. Resetting the Pi Pico with RUN will cause the boot ROM to load, like at power on. Resetting the 6502 from keyboard or UART will only return you to the kernel CLI.</p>
</div>
<div class="section" id="registers">
<h3><a class="toc-backref" href="#id6">2.2. Registers</a><a class="headerlink" href="#registers" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 5%" />
<col style="width: 90%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Address</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>$FFE0</p></td>
<td><p>READY</p></td>
<td><dl class="simple">
<dt>Flow control for UART FIFO.</dt><dd><ul class="simple">
<li><p>bit 7 - TX FIFO not full. Ok to send.</p></li>
<li><p>bit 6 - RX FIFO has data ready.</p></li>
</ul>
</dd>
</dl>
</td>
</tr>
<tr class="row-odd"><td><p>$FFE1</p></td>
<td><p>TX</p></td>
<td><p>Write bytes to the UART.</p></td>
</tr>
<tr class="row-even"><td><p>$FFE2</p></td>
<td><p>RX</p></td>
<td><p>Read bytes from the UART.</p></td>
</tr>
<tr class="row-odd"><td><p>$FFE3</p></td>
<td></td>
<td><p>Reserved. To be used for video frame counter.</p></td>
</tr>
<tr class="row-even"><td><p>$FFE4</p></td>
<td><p>RW0</p></td>
<td><p>Read or write the XRAM referenced by ADDR0.</p></td>
</tr>
<tr class="row-odd"><td><p>$FFE5</p></td>
<td><p>STEP0</p></td>
<td><p>Signed byte added to ADDR0 after every access to RW0.</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">$FFE6 -</div>
<div class="line">$FFE7</div>
</div>
</td>
<td><p>ADDR0</p></td>
<td><p>Address of XRAM for RW0.</p></td>
</tr>
<tr class="row-odd"><td><p>$FFE8</p></td>
<td><p>RW1</p></td>
<td><p>Read or write the XRAM referenced by ADDR1.</p></td>
</tr>
<tr class="row-even"><td><p>$FFE9</p></td>
<td><p>STEP1</p></td>
<td><p>Signed byte added to ADDR1 after every access to RW1.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">$FFEA -</div>
<div class="line">$FFEB</div>
</div>
</td>
<td><p>ADDR1</p></td>
<td><p>Address of XRAM for RW1.</p></td>
</tr>
<tr class="row-even"><td><p>$FFEC</p></td>
<td><p>XSTACK</p></td>
<td><p>256 bytes for passing kernel parameters.</p></td>
</tr>
<tr class="row-odd"><td><p>$FFED</p></td>
<td><p>ERRNO_LO</p></td>
<td><p>Low byte of errno. All errors fit in this byte.</p></td>
</tr>
<tr class="row-even"><td><p>$FFEE</p></td>
<td><p>ERRNO_HI</p></td>
<td><p>Ensures errno is an optionally a 16-bit int.</p></td>
</tr>
<tr class="row-odd"><td><p>$FFEF</p></td>
<td><p>OP</p></td>
<td><p>Write the API operation id here to begin a kernel call.</p></td>
</tr>
<tr class="row-even"><td><p>$FFF0</p></td>
<td><p>NOP</p></td>
<td><p>Always $EA.</p></td>
</tr>
<tr class="row-odd"><td><p>$FFF1</p></td>
<td><p>RETURN</p></td>
<td><p>Always $80, BRA. Entry to blocking API return.</p></td>
</tr>
<tr class="row-even"><td><p>$FFF2</p></td>
<td><p>BUSY</p></td>
<td><p>Bit 7 high while operation is running.</p></td>
</tr>
<tr class="row-odd"><td><p>$FFF3</p></td>
<td><p>LDA</p></td>
<td><p>Always $A9.</p></td>
</tr>
<tr class="row-even"><td><p>$FFF4</p></td>
<td><p>A</p></td>
<td><p>Kernel register A.</p></td>
</tr>
<tr class="row-odd"><td><p>$FFF5</p></td>
<td><p>LDX</p></td>
<td><p>Always $A2.</p></td>
</tr>
<tr class="row-even"><td><p>$FFF6</p></td>
<td><p>X</p></td>
<td><p>Kernel register X.</p></td>
</tr>
<tr class="row-odd"><td><p>$FFF7</p></td>
<td><p>RTS</p></td>
<td><p>Always $60.</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">$FFF8 -</div>
<div class="line">$FFF9</div>
</div>
</td>
<td><p>SREG</p></td>
<td><p>32-bit extension to AX - AXSREG.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">$FFFA -</div>
<div class="line">$FFFB</div>
</div>
</td>
<td><p>NMIB</p></td>
<td><p>6502 vector.</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">$FFFC -</div>
<div class="line">$FFFD</div>
</div>
</td>
<td><p>RESB</p></td>
<td><p>6502 vector.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">$FFFE -</div>
<div class="line">$FFFF</div>
</div>
</td>
<td><p>BRK/IRQB</p></td>
<td><p>6502 vector.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="uart">
<h3><a class="toc-backref" href="#id7">2.3. UART</a><a class="headerlink" href="#uart" title="Permalink to this headline">¶</a></h3>
<p>Easy and direct access to the UART RX/TX pins of the <a class="reference internal" href="#"><span class="doc">RP6502-RIA</span></a> is available from $FFE0-$FFE2. The ready flags on bits 6-7 enable testing with the BIT operator. You may choose to use these or STDIN and STDOUT from the <a class="reference internal" href="api.html"><span class="doc">RP6502-API</span></a>. Using the UART directly while a STDIN or STDOUT kernel function is in progress will result in undefined behavior.</p>
</div>
<div class="section" id="extended-ram-xram">
<h3><a class="toc-backref" href="#id8">2.4. Extended RAM (XRAM)</a><a class="headerlink" href="#extended-ram-xram" title="Permalink to this headline">¶</a></h3>
<p>RW0 and RW1 are two portals to the same 64K XRAM. Having only one portal would make moving XRAM very slow since data would have to buffer in 6502 RAM. Ideally, you won’t move XRAM and can use the pair for better optimizations.</p>
<p>STEP0 and STEP1 are reset to 1. These are signed so you can go backwards and reverse data. These adders allow for very fast sequential access, which typically make up for the slightly slower random access as compared to 6502 RAM.</p>
</div>
<div class="section" id="extended-stack-xstack">
<h3><a class="toc-backref" href="#id9">2.5. Extended Stack (XSTACK)</a><a class="headerlink" href="#extended-stack-xstack" title="Permalink to this headline">¶</a></h3>
<p>This is 256 bytes of last-in, first-out, top-down stack used for the fastcall mechanism described in the <a class="reference internal" href="api.html"><span class="doc">RP6502-API</span></a>. Reading past the end is guaranteed to return zeros.</p>
</div>
</div>
<div class="section" id="pico-information-exchange-pix">
<h2><a class="toc-backref" href="#id10">3. Pico Information Exchange (PIX)</a><a class="headerlink" href="#pico-information-exchange-pix" title="Permalink to this headline">¶</a></h2>
<p>The limited numbers of GPIO pins on the Raspberry Pi Pico required creating a new bus for high bandwidth devices like video systems. This is an addressable broadcast system which any numbers of devices can listen to.</p>
<div class="section" id="physical-layer">
<h3><a class="toc-backref" href="#id11">3.1. Physical layer</a><a class="headerlink" href="#physical-layer" title="Permalink to this headline">¶</a></h3>
<p>The physical layer is designed to be easily decoded by Pi Pico PIO, which is just a fancy shift register. The signals used are PHI2 and PIX0-3. This is a double data rate bus with PIX0-3 shifted left on both transitions of PHI2. A frame consists of 32 bits transmitted over 4 cycles of PHI2.</p>
<p>Bit 28 (0x10000000) is the framing bit. This bit will be sent in all messages. An all zero payload is repeated on channel 7 when the bus is idle. A receiver will synchronize by ensuring PIX0 is high on a low transition of PHI2. If it is not, stall until the next clock cycle.</p>
<p>Bits 31-29 (0xE0000000) indicate the channel number for a message.</p>
<p>Channel 0 broadcasts XRAM. Bits 15-0 is the XRAM address. Bits 23-16 is the XRAM data.</p>
<p>Channels 1-6 carry device specific information, typically XREG.  Bits 27-16 is the XREG address. Bits 15-0 is the XREG data.</p>
<p>Channel 7 is used for synchronization. Because 0xF0000000 is hard to miss on test equipment.</p>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id12">3.2. Extended RAM (XRAM)</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>All changes to the 64KB of XRAM on the RIA will be broadcast on PIX channel 0. PIX devices will maintain a replica of the XRAM they use. Typically, all 64K is replicated and an XREG set by the application will point to XRAM.</p>
</div>
<div class="section" id="pix-registers-xreg">
<h3><a class="toc-backref" href="#id13">3.3. PIX Registers (XREG)</a><a class="headerlink" href="#pix-registers-xreg" title="Permalink to this headline">¶</a></h3>
<p>Channels 1-6 are used to address the registers of specific PIX devices. For example, channel 1 is used by <a class="reference internal" href="vga.html"><span class="doc">RP6502-VGA</span></a>. The remaining channels are suitable for additional video and sound devices.</p>
<p>Each register is 16 bits, the perfect length to point to XRAM. PIX devices may have up to 4096 unique registers.</p>
</div>
<div class="section" id="pix-halt">
<h3><a class="toc-backref" href="#id14">3.4. PIX Halt</a><a class="headerlink" href="#pix-halt" title="Permalink to this headline">¶</a></h3>
<p>A halt message is sent upon initial boot and every time the 6502 returns to the kernel CLI. This is sent to all 6 device channels in XREG 0xFFF. This data is a bitfield with configuration information from the RIA. A PIX device should reset itself upon receiving this message.</p>
<dl>
<dt>Bits 0-1: Monitor type.</dt><dd><div class="line-block">
<div class="line">0x0 - SD 4:3 640x480</div>
<div class="line">0x1 - HD 16:9 640x480 and 1280x720</div>
<div class="line">0x2 - SXGA 5:4 1280x1024</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="fm-audio-synthesizer">
<h2><a class="toc-backref" href="#id15">4. FM Audio Synthesizer</a><a class="headerlink" href="#fm-audio-synthesizer" title="Permalink to this headline">¶</a></h2>
<p>The RIA includes an FM Audio Synthesizer on PIX channel 0.</p>
<p>Note that XREGs for PIX device 0 do not actually get broadcast on the PIX bus. This is a special device built-in to the RIA. Overloading channel 0, which is also used for XRAM, is done to provide an extra hardware address.</p>
<p>Note that audio software hasn’t been written yet.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">RP6502</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">RIA</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">1. Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#features-of-the-rp6502-ria">1.1. Features of the RP6502-RIA</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#functional-description">2. Functional Description</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#reset">2.1. Reset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#registers">2.2. Registers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#uart">2.3. UART</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extended-ram-xram">2.4. Extended RAM (XRAM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extended-stack-xstack">2.5. Extended Stack (XSTACK)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pico-information-exchange-pix">3. Pico Information Exchange (PIX)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#physical-layer">3.1. Physical layer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">3.2. Extended RAM (XRAM)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pix-registers-xreg">3.3. PIX Registers (XREG)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pix-halt">3.4. PIX Halt</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fm-audio-synthesizer">4. FM Audio Synthesizer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vga.html">VGA</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Picocomputer 6502</a></li>
      <li>Next: <a href="vga.html" title="next chapter">RP6502-VGA</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023 Rumbledethumps.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/ria.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>