
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>RP6502-API &#8212; RP6502 0.0-pre documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="RP6502-RFC" href="rfc.html" />
    <link rel="prev" title="RP6502-VGA" href="vga.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="rp6502-api">
<h1>RP6502-API<a class="headerlink" href="#rp6502-api" title="Permalink to this headline">¶</a></h1>
<p>Rumbledethumps Picocomputer 6502 Application Programming Interface.</p>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">1. Introduction</a></p></li>
<li><p><a class="reference internal" href="#calling-with-fastcall" id="id2">2. Calling with fastcall</a></p>
<ul>
<li><p><a class="reference internal" href="#short-stacking" id="id3">2.1. Short Stacking</a></p></li>
<li><p><a class="reference internal" href="#shorter-integers" id="id4">2.2. Shorter Integers</a></p></li>
<li><p><a class="reference internal" href="#bulk-data" id="id5">2.3. Bulk Data</a></p>
<ul>
<li><p><a class="reference internal" href="#bulk-xstack-operations" id="id6">2.3.1. Bulk XSTACK Operations</a></p></li>
<li><p><a class="reference internal" href="#bulk-xram-operations" id="id7">2.3.2. Bulk XRAM Operations</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#function-reference" id="id8">1. Function Reference</a></p>
<ul>
<li><p><a class="reference internal" href="#zxstack" id="id9">zxstack</a></p></li>
<li><p><a class="reference internal" href="#xreg" id="id10">xreg</a></p></li>
<li><p><a class="reference internal" href="#phi2" id="id11">phi2</a></p></li>
<li><p><a class="reference internal" href="#codepage" id="id12">codepage</a></p></li>
<li><p><a class="reference internal" href="#lrand" id="id13">lrand</a></p></li>
<li><p><a class="reference internal" href="#open" id="id14">open</a></p></li>
<li><p><a class="reference internal" href="#close" id="id15">close</a></p></li>
<li><p><a class="reference internal" href="#read" id="id16">read</a></p></li>
<li><p><a class="reference internal" href="#read-xstack" id="id17">read_xstack</a></p></li>
<li><p><a class="reference internal" href="#read-xram" id="id18">read_xram</a></p></li>
<li><p><a class="reference internal" href="#write" id="id19">write</a></p></li>
<li><p><a class="reference internal" href="#write-xstack" id="id20">write_xstack</a></p></li>
<li><p><a class="reference internal" href="#write-xram" id="id21">write_xram</a></p></li>
<li><p><a class="reference internal" href="#lseek" id="id22">lseek</a></p></li>
<li><p><a class="reference internal" href="#exit" id="id23">exit</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#id1">1. Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="ria.html"><span class="doc">RP6502-RIA</span></a> runs a protected 32-bit kernel that you can call from the 6502. The kernel runs on a processor that is significantly faster than a 6502. This is the only practical way to run modern file systems, networking, and USB host stacks.</p>
<p>The RP6502 presents an opportunity to create a new type of operating system. A 6502 OS based on the C programming language with familiar POSIX-like operations.</p>
</div>
<div class="section" id="calling-with-fastcall">
<h2><a class="toc-backref" href="#id2">2. Calling with fastcall</a><a class="headerlink" href="#calling-with-fastcall" title="Permalink to this headline">¶</a></h2>
<p>The binary interface is based on fastcall from the <a class="reference external" href="https://cc65.github.io/doc/cc65-intern.html">CC65 Internals</a>. The RP6502 fastcall does not use or require anything from CC65 and is easy for assembly programmers to use. At its core, the API is based on a C ABI with three simple rules.</p>
<ul class="simple">
<li><p>Stack arguments are pushed left to right.</p></li>
<li><p>Last argument optionally passed by register A, AX, or AXSREG.</p></li>
<li><p>Return value in register AX or AXSREG.</p></li>
</ul>
<p>A and X are the 6502 registers. The register AX combines them for 16 bits. AXSREG is 32 bits with the SREG bits in zero page.  Let’s look at how to make an OS call through the RIA registers. All kernel calls are specified as a C declaration like so:</p>
<dl class="function">
<dt>
<code class="sig-name descname">int doit(int arg0, int arg1);</code></dt>
<dd></dd></dl>

<p>The RIA has registers called RIA_A, RIA_X, and RIA_SREG. An int is 16 bits, so we set the RIA_A and RIA_X registers with arg1. I’ll use “A” for the 6502 register and “RIA_A” for the RIA register in this explanation.</p>
<p>We use the XSTACK for arg0. Reading or writing data to the RIA_XSTACK register removes or adds bytes to the XSTACK. It’s a top-down stack, so push each argument from left to right and maintain little endian-ness in memory.</p>
<p>To execute the call, store the operation ID in RIA_OP. The operation begins immediately. You can keep doing 6502 things, like running a loading animation, by polling RIA_BUSY. Or, JSR RIA_SPIN to block.</p>
<p>The JSR RIA_SPIN method can unblock in less than 3 clock cycles and does an immediate load of A and X. Sequential operations will run fastest with this technique. Under the hood, you’re jumping into a self-modifying program that runs on the RIA registers.</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span><span class="nf">BRA</span> <span class="c">#$??      ; RIA_BUSY {-2 or 0}</span>
<span class="nf">LDA</span> <span class="c">#$??      ; RIA_A</span>
<span class="nf">LDX</span> <span class="c">#$??      ; RIA_X</span>
<span class="nf">RTS</span>
</pre></div>
</div>
<p>Polling is simply snooping on the above program. The RIA_BUSY register is the -2 or 0 in the BRA above. The RIA datasheet specifies bit 7 indicates busy, which the 6502 can check quickly by using the BIT operator to set flag N. Once clear, we read RIA_A and RIA_X with absolute instructions.</p>
<div class="highlight-asm notranslate"><div class="highlight"><pre><span></span><span class="nl">wait:</span>
<span class="nf">BIT</span> <span class="no">RIA_BUSY</span>
<span class="nf">BMI</span> <span class="no">wait</span>
<span class="nf">LDA</span> <span class="no">RIA_A</span>
<span class="nf">LDX</span> <span class="no">RIA_X</span>
</pre></div>
</div>
<p>All operations returning RIA_A will also return RIA_X to assist with CC65’s integer promotion requirements. RIA_SREG is only updated for 32-bit returns. RIA_ERRNO is only updated if there is an error.</p>
<p>Some operations return data on the stack. You must pull the entire stack before the next call. However, tail call optimizations are possible. For example, you can chain read_xstack() and write_xstack() to copy a file without using any RAM or XRAM.</p>
<div class="section" id="short-stacking">
<h3><a class="toc-backref" href="#id3">2.1. Short Stacking</a><a class="headerlink" href="#short-stacking" title="Permalink to this headline">¶</a></h3>
<p>In the never ending pursuit of saving all the clocks, it is possible to save a few on the stack push if you don’t need all the range. This only works on the stack argument that gets pushed first. For example:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">long</span> <span class="n">lseek_impl</span><span class="p">(</span><span class="kt">long</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">char</span> <span class="n">whence</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fildes</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we are asked for a 64 bit value. Not coincidentally, it’s in the right position for short stacking. If, for example, you only need 24 bits, push only three bytes. The significant bytes will be implicit.</p>
</div>
<div class="section" id="shorter-integers">
<h3><a class="toc-backref" href="#id4">2.2. Shorter Integers</a><a class="headerlink" href="#shorter-integers" title="Permalink to this headline">¶</a></h3>
<p>Many operations can save a few clocks by ignoring REG_X. All integers are always available as 16 bits to assist with CC65 and integer promotion. However, many operations will ignore REG_X on the register parameter and limit their return to fit in REG_A. This will be documented below as “A regs”.</p>
</div>
<div class="section" id="bulk-data">
<h3><a class="toc-backref" href="#id5">2.3. Bulk Data</a><a class="headerlink" href="#bulk-data" title="Permalink to this headline">¶</a></h3>
<p>Functions that move bulk data may come in two flavors. These are any function with a pointer parameter. This pointer is meaningless to the kernel because it can not change 6502 RAM. Instead, we use the XSTACK or XRAM for data buffers.</p>
<div class="section" id="bulk-xstack-operations">
<h4><a class="toc-backref" href="#id6">2.3.1. Bulk XSTACK Operations</a><a class="headerlink" href="#bulk-xstack-operations" title="Permalink to this headline">¶</a></h4>
<p>These only work if the count is 256 or less. Bulk data is passed on the XSTACK, which is 256 bytes. A pointer appears in the C prototype to indicate the type and direction of this data. Let’s look at some examples.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">open</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oflag</span><span class="p">);</span>
</pre></div>
</div>
<p>Send <cite>oflag</cite> in AX. Send the path on XSTACK by pushing the string starting with the last character. You may omit pushing the terminating zero, but strings are limited to a length of 255. Calling this from the C SDK will “just work” because there’s an implementation that pushes the string for you.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">read_xstack</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fildes</span><span class="p">)</span>
</pre></div>
</div>
<p>Send <cite>count</cite> as a short stack and <cite>fildes</cite> in AX. The returned value in AX indicates how many values must be pulled from the stack. If you call this from the C SDK then it will copy XSTACK to buf[] for you.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">write_xstack</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fildes</span><span class="p">)</span>
</pre></div>
</div>
<p>Send <cite>fildes</cite> in AX. Push the data to XSTACK. Do not send <cite>count</cite>, the kernel knows this from its internal stack pointer. If you call this from the C SDK then it will copy buf[] to XSTACK for you.</p>
<p>Note that read() and write() are part of the C SDK, not a kernel operation. CC65 requires them to support more than 256 bytes, so they have wrapper logic to make multiple kernel calls when necessary.</p>
</div>
<div class="section" id="bulk-xram-operations">
<h4><a class="toc-backref" href="#id7">2.3.2. Bulk XRAM Operations</a><a class="headerlink" href="#bulk-xram-operations" title="Permalink to this headline">¶</a></h4>
<p>These load and save XRAM directly. You can load game assets without going through 6502 RAM or capture a screenshot with ease.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">read_xram</span><span class="p">(</span><span class="n">xram_addr</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fildes</span><span class="p">)</span>
<span class="kt">int</span> <span class="n">write_xram</span><span class="p">(</span><span class="n">xram_addr</span> <span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">count</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fildes</span><span class="p">)</span>
</pre></div>
</div>
<p>The kernel expects <cite>buf</cite> and <cite>count</cite> on the XSTACK as integers with <cite>filedes</cite> in AX. The buffer is effectively &amp;XRAM[buf] here. There’s nothing special about these calls in regards to how the binary interface rules are applied. They are interesting because of their high performance for loading assets.</p>
</div>
</div>
</div>
<div class="section" id="function-reference">
<h2><a class="toc-backref" href="#id8">1. Function Reference</a><a class="headerlink" href="#function-reference" title="Permalink to this headline">¶</a></h2>
<p>Much of this API is based on CC65 and POSIX. In particular, filesystem access should feel extremely modern. However, some operations will have different argument orders or bitfield values than what you’re used to. The reason for this becomes apparent when you start to work in assembly and fine tune short stacking and integer demotions. You might not notice the differences if you only work in C because the standard library has wrapper functions and familiar prototypes. For example, the lseek_impl() described below has reorderd arguments that are optimized for short stacking the long argument. But you never call lseek_impl() from C, you call the usual lseek() which has the traditional argument order.</p>
<div class="section" id="zxstack">
<h3><a class="toc-backref" href="#id9">zxstack</a><a class="headerlink" href="#zxstack" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt>
<code class="sig-name descname">void zxstack(void);</code></dt>
<dd></dd></dl>

<p>Abandon the xstack by resetting the pointer. Not needed for normal operation. This is the only operation that doesn’t require waiting for completion.</p>
</div>
<div class="section" id="xreg">
<h3><a class="toc-backref" href="#id10">xreg</a><a class="headerlink" href="#xreg" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt>
<code class="sig-name descname">int xreg(char device, char channel, unsigned char address, ...);</code></dt>
<dd><p>Set extended registers on a PIX device. See the <a class="reference internal" href="ria.html"><span class="doc">RP6502-RIA</span></a> and <a class="reference internal" href="vga.html"><span class="doc">RP6502-VGA</span></a> documentation for what each register does. Setting extended registers can fail, which you should use for feature detection. EINVAL means the device responded with a negative acknowledgementg. EIO means there was a timeout waiting for ack/nak.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>device</strong> – PIX device ID. 0-6</p></li>
<li><p><strong>channel</strong> – PIX channel. 0-15</p></li>
<li><p><strong>address</strong> – PIX address. 0-255</p></li>
<li><p><strong>...</strong> – 16 bit integers to set starting at address.</p></li>
</ul>
</dd>
<dt class="field-even">A regs</dt>
<dd class="field-even"><p>devid</p>
</dd>
<dt class="field-odd">Errno</dt>
<dd class="field-odd"><p>EINVAL, EIO</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="phi2">
<h3><a class="toc-backref" href="#id11">phi2</a><a class="headerlink" href="#phi2" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.phi2">
unsigned <code class="sig-name descname">phi2</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.phi2" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves the PHI2 setting from the RIA. Applications can use this for adjusting to or rejecting different clock speeds.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The 6502 clock speed in kHz.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="codepage">
<h3><a class="toc-backref" href="#id12">codepage</a><a class="headerlink" href="#codepage" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.codepage">
unsigned <code class="sig-name descname">codepage</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.codepage" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieves the CP setting from the RIA. This is the encoding the filesystem is using and, if VGA is installed, the console and default font.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The code page. One of: 437, 720, 737, 771, 775, 850, 852, 855, 857, 860, 861, 862, 863, 864, 865, 866, 869, 932, 936, 949, 950.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="lrand">
<h3><a class="toc-backref" href="#id13">lrand</a><a class="headerlink" href="#lrand" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.lrand">
unsigned long <code class="sig-name descname">lrand</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.lrand" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a random number starting with entropy on the RIA. This is suitable for seeding a RNG or general use. The 16-bit rand() in the CC65 library can be seeded with this by calling its non-standard _randomize() function.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Chaos.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="open">
<h3><a class="toc-backref" href="#id14">open</a><a class="headerlink" href="#open" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.open">
int <code class="sig-name descname">open</code><span class="sig-paren">(</span>const char<em> *path</em>, int<em> oflag</em><span class="sig-paren">)</span><a class="headerlink" href="#c.open" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a connection between a file and a file descriptor.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> – Pathname to a file.</p></li>
<li><p><strong>oflag</strong> – Bitfield of options.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>File descriptor. -1 on error.</p>
</dd>
<dt class="field-odd">A regs</dt>
<dd class="field-odd"><p>return, oflag</p>
</dd>
<dt class="field-even">Errno</dt>
<dd class="field-even"><p>EINVAL, EMFILE, FR_DISK_ERR, FR_INT_ERR, FR_NOT_READY, FR_NO_FILE, FR_NO_PATH, FR_INVALID_NAME, FR_DENIED, FR_EXIST, FR_INVALID_OBJECT, FR_WRITE_PROTECTED, FR_INVALID_DRIVE, FR_NOT_ENABLED, FR_NO_FILESYSTEM, FR_TIMEOUT, FR_LOCKED, FR_NOT_ENOUGH_CORE, FR_TOO_MANY_OPEN_FILES</p>
</dd>
<dt class="field-odd">Options</dt>
<dd class="field-odd"><div class="line-block">
<div class="line">O_RDONLY 0x01</div>
<div class="line-block">
<div class="line">Open for reading only.</div>
</div>
<div class="line">O_WRONLY 0x02</div>
<div class="line-block">
<div class="line">Open for writing only.</div>
</div>
<div class="line">O_RDWR 0x03</div>
<div class="line-block">
<div class="line">Open for reading and writing.</div>
</div>
<div class="line">O_CREAT 0x10</div>
<div class="line-block">
<div class="line">Create the file if it does not exist.</div>
</div>
<div class="line">O_TRUNC 0x20</div>
<div class="line-block">
<div class="line">Truncate the file length to 0 after opening.</div>
</div>
<div class="line">O_APPEND 0x40</div>
<div class="line-block">
<div class="line">Read/write pointer is set end of the file.</div>
</div>
<div class="line">O_EXCL 0x80</div>
<div class="line-block">
<div class="line">If O_CREAT and O_EXCL are set, fail if the file exists.</div>
</div>
</div>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="close">
<h3><a class="toc-backref" href="#id15">close</a><a class="headerlink" href="#close" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.close">
int <code class="sig-name descname">close</code><span class="sig-paren">(</span>int<em> fildes</em><span class="sig-paren">)</span><a class="headerlink" href="#c.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Release the file descriptor. File descriptor will rejoin the pool available for use by open().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fildes</strong> – File descriptor from open().</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>0 on success. -1 on error.</p>
</dd>
<dt class="field-odd">A regs</dt>
<dd class="field-odd"><p>return, fildes</p>
</dd>
<dt class="field-even">Errno</dt>
<dd class="field-even"><p>EINVAL, FR_DISK_ERR, FR_INT_ERR, FR_INVALID_OBJECT, FR_TIMEOUT</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="read">
<h3><a class="toc-backref" href="#id16">read</a><a class="headerlink" href="#read" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.read">
int <code class="sig-name descname">read</code><span class="sig-paren">(</span>int<em> fildes</em>, void<em> *buf</em>, unsigned<em> count</em><span class="sig-paren">)</span><a class="headerlink" href="#c.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read <cite>count</cite> bytes from a file to a buffer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buf</strong> – Destination for the returned data.</p></li>
<li><p><strong>count</strong> – Quantity of bytes to read. 0x7FFF max.</p></li>
<li><p><strong>fildes</strong> – File descriptor from open().</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>On success, number of bytes read is returned. On error, -1 is returned.</p>
</dd>
<dt class="field-odd">A regs</dt>
<dd class="field-odd"><p>fildes</p>
</dd>
<dt class="field-even">Errno</dt>
<dd class="field-even"><p>EINVAL, FR_DISK_ERR, FR_INT_ERR, FR_DENIED, FR_INVALID_OBJECT, FR_TIMEOUT</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="read-xstack">
<h3><a class="toc-backref" href="#id17">read_xstack</a><a class="headerlink" href="#read-xstack" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.read_xstack">
int <code class="sig-name descname">read_xstack</code><span class="sig-paren">(</span>void<em> *buf</em>, unsigned<em> count</em>, int<em> fildes</em><span class="sig-paren">)</span><a class="headerlink" href="#c.read_xstack" title="Permalink to this definition">¶</a></dt>
<dd><p>Read <cite>count</cite> bytes from a file to xstack.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buf</strong> – Destination for the returned data.</p></li>
<li><p><strong>count</strong> – Quantity of bytes to read. 0x100 max.</p></li>
<li><p><strong>fildes</strong> – File descriptor from open().</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>On success, number of bytes read is returned. On error, -1 is returned.</p>
</dd>
<dt class="field-odd">A regs</dt>
<dd class="field-odd"><p>fildes</p>
</dd>
<dt class="field-even">Errno</dt>
<dd class="field-even"><p>EINVAL, FR_DISK_ERR, FR_INT_ERR, FR_DENIED, FR_INVALID_OBJECT, FR_TIMEOUT</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="read-xram">
<h3><a class="toc-backref" href="#id18">read_xram</a><a class="headerlink" href="#read-xram" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.read_xram">
int <code class="sig-name descname">read_xram</code><span class="sig-paren">(</span>unsigned<em> buf</em>, unsigned<em> count</em>, int<em> fildes</em><span class="sig-paren">)</span><a class="headerlink" href="#c.read_xram" title="Permalink to this definition">¶</a></dt>
<dd><p>Read <cite>count</cite> bytes from a file to xram.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buf</strong> – Destination for the returned data.</p></li>
<li><p><strong>count</strong> – Quantity of bytes to read. 0x7FFF max.</p></li>
<li><p><strong>fildes</strong> – File descriptor from open().</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>On success, number of bytes read is returned. On error, -1 is returned.</p>
</dd>
<dt class="field-odd">A regs</dt>
<dd class="field-odd"><p>fildes</p>
</dd>
<dt class="field-even">Errno</dt>
<dd class="field-even"><p>EINVAL, FR_DISK_ERR, FR_INT_ERR, FR_DENIED, FR_INVALID_OBJECT, FR_TIMEOUT</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="write">
<h3><a class="toc-backref" href="#id19">write</a><a class="headerlink" href="#write" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.write">
int <code class="sig-name descname">write</code><span class="sig-paren">(</span>int<em> fildes</em>, const void<em> *buf</em>, unsigned<em> count</em><span class="sig-paren">)</span><a class="headerlink" href="#c.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write <cite>count</cite> bytes from buffer to a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buf</strong> – Location of the data.</p></li>
<li><p><strong>count</strong> – Quantity of bytes to write. 0x7FFF max.</p></li>
<li><p><strong>fildes</strong> – File descriptor from open().</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>On success, number of bytes written is returned. On error, -1 is returned.</p>
</dd>
<dt class="field-odd">A regs</dt>
<dd class="field-odd"><p>fildes</p>
</dd>
<dt class="field-even">Errno</dt>
<dd class="field-even"><p>EINVAL, FR_DISK_ERR, FR_INT_ERR, FR_DENIED, FR_INVALID_OBJECT, FR_TIMEOUT</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="write-xstack">
<h3><a class="toc-backref" href="#id20">write_xstack</a><a class="headerlink" href="#write-xstack" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.write_xstack">
int <code class="sig-name descname">write_xstack</code><span class="sig-paren">(</span>const void<em> *buf</em>, unsigned<em> count</em>, int<em> fildes</em><span class="sig-paren">)</span><a class="headerlink" href="#c.write_xstack" title="Permalink to this definition">¶</a></dt>
<dd><p>Write <cite>count</cite> bytes from xstack to a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buf</strong> – Location of the data.</p></li>
<li><p><strong>count</strong> – Quantity of bytes to write. 0x100 max.</p></li>
<li><p><strong>fildes</strong> – File descriptor from open().</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>On success, number of bytes written is returned. On error, -1 is returned.</p>
</dd>
<dt class="field-odd">A regs</dt>
<dd class="field-odd"><p>fildes</p>
</dd>
<dt class="field-even">Errno</dt>
<dd class="field-even"><p>EINVAL, FR_DISK_ERR, FR_INT_ERR, FR_DENIED, FR_INVALID_OBJECT, FR_TIMEOUT</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="write-xram">
<h3><a class="toc-backref" href="#id21">write_xram</a><a class="headerlink" href="#write-xram" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.write_xram">
int <code class="sig-name descname">write_xram</code><span class="sig-paren">(</span>unsigned<em> buf</em>, unsigned<em> count</em>, int<em> fildes</em><span class="sig-paren">)</span><a class="headerlink" href="#c.write_xram" title="Permalink to this definition">¶</a></dt>
<dd><p>Write <cite>count</cite> bytes from xram to a file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>buf</strong> – Location of the data.</p></li>
<li><p><strong>count</strong> – Quantity of bytes to write. 0x7FFF max.</p></li>
<li><p><strong>fildes</strong> – File descriptor from open().</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>On success, number of bytes written is returned. On error, -1 is returned.</p>
</dd>
<dt class="field-odd">A regs</dt>
<dd class="field-odd"><p>fildes</p>
</dd>
<dt class="field-even">Errno</dt>
<dd class="field-even"><p>EINVAL, FR_DISK_ERR, FR_INT_ERR, FR_DENIED, FR_INVALID_OBJECT, FR_TIMEOUT</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="lseek">
<h3><a class="toc-backref" href="#id22">lseek</a><a class="headerlink" href="#lseek" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.lseek">
off_t <code class="sig-name descname">lseek</code><span class="sig-paren">(</span>int<em> fildes</em>, off_t<em> offset</em>, int<em> whence</em><span class="sig-paren">)</span><a class="headerlink" href="#c.lseek" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="c.lseek_impl">
static long <code class="sig-name descname">lseek_impl</code><span class="sig-paren">(</span>long<em> offset</em>, char<em> whence</em>, int<em> fildes</em><span class="sig-paren">)</span><a class="headerlink" href="#c.lseek_impl" title="Permalink to this definition">¶</a></dt>
<dd><p>Move the read/write pointer. This is implemented internally with an argument order to take advantage of short stacking the offset.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>offset</strong> – How far you wish to seek.</p></li>
<li><p><strong>whence</strong> – From whence you wish to seek.</p></li>
<li><p><strong>fildes</strong> – File descriptor from open().</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Read/write position. -1 on error. If this value would be too large for a long, the returned value will be 0x7FFFFFFF.</p>
</dd>
<dt class="field-odd">A regs</dt>
<dd class="field-odd"><p>fildes</p>
</dd>
<dt class="field-even">Errno</dt>
<dd class="field-even"><p>EINVAL, FR_DISK_ERR, FR_INT_ERR, FR_INVALID_OBJECT, FR_TIMEOUT</p>
</dd>
<dt class="field-odd">Whence</dt>
<dd class="field-odd"><div class="line-block">
<div class="line">SEEK_SET = 2</div>
<div class="line-block">
<div class="line">The start of the file plus offset bytes.</div>
</div>
<div class="line">SEEK_CUR = 0</div>
<div class="line-block">
<div class="line">The current location plus offset bytes.</div>
</div>
<div class="line">SEEK_END = 1</div>
<div class="line-block">
<div class="line">The size of the file plus offset bytes.</div>
</div>
</div>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="exit">
<h3><a class="toc-backref" href="#id23">exit</a><a class="headerlink" href="#exit" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.exit">
void <code class="sig-name descname">exit</code><span class="sig-paren">(</span>int<em> status</em><span class="sig-paren">)</span><a class="headerlink" href="#c.exit" title="Permalink to this definition">¶</a></dt>
<dd><p>Halt the 6502 and return to the kernel command interface. This is the only operation that does not return. RESB will be pulled down before the next instruction can execute. Status is currently ignored but will be used in the future.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>status</strong> – 0 is good, 1-255 for error.</p></li>
</ul>
</dd>
<dt class="field-even">A regs</dt>
<dd class="field-even"><p>status</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">RP6502</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="hardware.html">Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="ria.html">RIA</a></li>
<li class="toctree-l1"><a class="reference internal" href="vga.html">VGA</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calling-with-fastcall">2. Calling with fastcall</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#short-stacking">2.1. Short Stacking</a></li>
<li class="toctree-l3"><a class="reference internal" href="#shorter-integers">2.2. Shorter Integers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bulk-data">2.3. Bulk Data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bulk-xstack-operations">2.3.1. Bulk XSTACK Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bulk-xram-operations">2.3.2. Bulk XRAM Operations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#function-reference">1. Function Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#zxstack">zxstack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xreg">xreg</a></li>
<li class="toctree-l3"><a class="reference internal" href="#phi2">phi2</a></li>
<li class="toctree-l3"><a class="reference internal" href="#codepage">codepage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lrand">lrand</a></li>
<li class="toctree-l3"><a class="reference internal" href="#open">open</a></li>
<li class="toctree-l3"><a class="reference internal" href="#close">close</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read">read</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read-xstack">read_xstack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read-xram">read_xram</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write">write</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write-xstack">write_xstack</a></li>
<li class="toctree-l3"><a class="reference internal" href="#write-xram">write_xram</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lseek">lseek</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exit">exit</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="rfc.html">RFC</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="vga.html" title="previous chapter">RP6502-VGA</a></li>
      <li>Next: <a href="rfc.html" title="next chapter">RP6502-RFC</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023 Rumbledethumps.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/api.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>